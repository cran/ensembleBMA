head	1.13;
access;
symbols;
locks
	fraley:1.13; strict;
comment	@# @;


1.13
date	2007.02.24.00.53.03;	author fraley;	state Exp;
branches;
next	1.12;

1.12
date	2007.02.24.00.52.37;	author fraley;	state Exp;
branches;
next	1.11;

1.11
date	2007.02.22.21.32.33;	author fraley;	state Exp;
branches;
next	1.10;

1.10
date	2007.02.22.20.00.25;	author fraley;	state Exp;
branches;
next	1.9;

1.9
date	2007.02.16.17.51.47;	author fraley;	state Exp;
branches;
next	1.8;

1.8
date	2007.01.31.23.31.26;	author fraley;	state Exp;
branches;
next	1.7;

1.7
date	2007.01.31.18.44.26;	author fraley;	state Exp;
branches;
next	1.6;

1.6
date	2006.12.05.21.41.18;	author fraley;	state Exp;
branches;
next	1.5;

1.5
date	2006.12.05.21.39.54;	author fraley;	state Exp;
branches;
next	1.4;

1.4
date	2006.12.05.21.38.32;	author fraley;	state Exp;
branches;
next	1.3;

1.3
date	2006.12.01.20.26.56;	author fraley;	state Exp;
branches;
next	1.2;

1.2
date	2006.12.01.20.26.42;	author fraley;	state Exp;
branches;
next	1.1;

1.1
date	2006.11.29.17.54.20;	author fraley;	state Exp;
branches;
next	;


desc
@@


1.13
log
@*** empty log message ***
@
text
@\name{fitBMAgamma0}
\alias{fitBMAgamma0}
\title{
    BMA for a mixture of gammas with a point mass at 0.
}
\description{
   Fits a Bayesian Modeling Averaging mixture of gammas 
   with a point mass at 0 to ensemble forecasting data.
   Intended for modeling precipitation.
}
\usage{
fitBMAgamma0( ensembleData, control = controlBMAgamma0(), popData = NULL) 
}
\arguments{
  \item{ensembleData}{
     An \code{ensembleData} object with forecasts, observations and dates
     for precipitation.
  }
  \item{control}{
     A list of control values for the fitting functions. The defaults are
     given by the function \code{controlBMAgamma0}.
  }
  \item{popData}{
      Optional predictors for the logistic regression for probability of 
      precipitation. This option applies to the mixture of gammas model with 
      a point mass at zero that is used for precipitation.
      In this model, the default predictors are an intercept, the
      transformed forecast data, and a logical variable indicating
      whether or not the forecast is equal to 0. 
      In addition, the coefficient of the transformed forecast must
      not be greater than 0 and that of the logical variable
      must not be less than 0 in the default.
      If provided, the predictors in \code{popData} would replace the logical
      variable in the regression, and no constraints are imposed on
      the regression coefficients. \cr    
      To supply one pop predictor per ensemble member,
      \code{popData} can be a matrix or data frame (if the
      predictor is categorical) with number of rows equal to the
      number of observations, and number of columns equal to the
      ensemble size. \cr
      To supply multiple numeric pop predictors per ensemble member,
      \code{popData} can be an array of dimension (number of
      observations) by (ensemble size) by (number of pop predictors). \cr
      To supply multiple pop predictors per ensemble member, some of
      which may be categorical, \code{popData} must be a list of
     (number of observations) by (ensemble size) matrices, one
      for each pop predictor.
 }
}
\value{
A list with the following output components:
  \item{prob0coefs}{
    The fitted coefficients in the model for the point mass at 0 
   for each member of the ensemble.
  }
  \item{biasCoefs}{
    The fitted coefficients in the model for the mean of nonzero observations
    for each member of the ensemble (used for bias correction).
  }
  \item{varCoefs}{
    The fitted coefficients for the model for the variance of nonzero 
    observations (these are the same for all members of the ensemble).
  }
  \item{weights}{
    The fitted weights for the mixture of gammas model for the
    nonzero observations.
  }
  \item{nIter}{
    The number of EM iterations.
  }
  \item{transformation}{
    The function corresponding the transformation of the data used to fit 
    the models for the  point mass at 0 and mean of nonzero observations. 
    The untransformed forecast is used to fit the variance model.
    This is input as part of \code{control}.
   }
  \item{inverseTransformation}{
    The function corresponding to the inverse of \code{transformation}.
    Used in various diagnostic methods for the output.
   }
}
\details{
   This function fits a BMA model to a training data set. \cr
   It is called by \code{ensembleBMAgamma0}, which produces a sequence
   of fits over a larger precipitation data set.  \cr
 The following methods are available for the output of \code{fitBMA}:
   \code{gridForecastBMA}, \code{quantileForecastBMA}, and 
   \code{bmaModelParameters}. 
}
\seealso{
  \code{\link{ensembleData}}, 
  \code{\link{controlBMAgamma0}}, 
  \code{\link{ensembleBMAgamma0}},
  \code{\link{gridForecastBMA}},
  \code{\link{quantileForecastBMA}},
  \code{\link{bmaModelParameters}}
}
\references{
J. M. Sloughter, A. E. Raftery, T. Gneiting and C. Fraley,
Probabilistic Quantitative Precipitation Forecasting
using Bayesian Model Averaging,
Technical Report No. 496R, Department of Statistics, University of
Washington, October 2006 (to appear in \emph{Montly Weather Review}).
}

\examples{
  data(prcp)

  prcpData <- ensembleData( dates = prcp$date, observations = prcp$obs,
                          forecasts = prcp[,c("CENT","AVN","CMCG","ETA",
                                      "GASP","JMA","NGPS","TCWB","UKMO")])

  DATE <- sort(unique(prcpData$dates))[27]
  trainDat <- trainingData(precpData, date = DATE,
                           trainingRule = list(length=25,lag=2))
  prcpFit25a <- fitBMAgamma0(trainDat)

  D <- as.numeric(prcpData$dates) <= 25
  prcpFit25b <- fitBMAgamma0(prcpData[D, ])

  prcpFit25c <- fitBMAgamma0(prcpData[D, ], 
                     popData = ensembleForecasts(prcpData[D,]) == 0)
}
\keyword{models}
% docclass is function
@


1.12
log
@*** empty log message ***
@
text
@d114 2
a115 2
  trainDat <- trainingData( precpData, date = DATE,
                   trainingRule = list(length=25,lag=2))
@


1.11
log
@*** empty log message ***
@
text
@d113 4
a116 2
  d <- as.numeric(prcpData$dates) <= 25
  prcpFit25a <- fitBMAgamma0(prcpData[d, ])
d118 5
a122 2
  prcpFit25b <- fitBMAgamma0(prcpData[d, ], 
                     popData = ensembleForecasts(prcpData[d,]) == 0)
@


1.10
log
@*** empty log message ***
@
text
@d113 1
a113 1
  d <- as.numeric(precip10data$dates) <= 25
@


1.9
log
@*** empty log message ***
@
text
@d107 1
d109 3
a111 4
# Note: a reduced data set training period are used in this
# and other help file examples for fast execution. A much larger
# training period (and hence more data) is typically needed for
# good forecasting results.
d113 2
a114 1
  data(precip10)
d116 2
a117 9
  precip10data <- ensembleData( forecasts = precip10[ ,1:5],
                                observations = precip10[ ,6],
                                dates = precip10[ , 7])

  d <- as.numeric(precip10data$dates) <= 5
  precip10fit5a <- fitBMAgamma0(precip10data[d, ], )

  precip10fit5b <- fitBMAgamma0(precip10data[d, ], 
                     popData = ensembleForecasts(precip10data[d,]) == 0)
@


1.8
log
@*** empty log message ***
@
text
@d87 2
a88 1
   \code{gridForecastBMA}, \code{quantileForecastBMA}, and \code{parameters}. 
d96 1
a96 1
  \code{\link{parameters}}
d119 1
a119 1
  d <- as.numeric(dates(precip10data)) <= 5
d123 1
a123 1
                                popData = forecasts(precip10data[d,]) == 0)
@


1.7
log
@*** empty log message ***
@
text
@d30 6
a35 2
      If provided, the predictors in \code{popData} would replace the logical 
      variable in the regression. \cr
d119 4
a122 1
  precip10fit5 <- fitBMAgamma0(precip10data[d, ], )
@


1.6
log
@*** empty log message ***
@
text
@d7 3
a9 2
   Fits a BMA mixture of gammas with a point mass at 0, which is appropriate
   for precipitation data.
d12 1
a12 2
fitBMAgamma0( ensembleData, control = gamma0BMAcontrol(), 
              start = list(varCoefs = NULL, weights = NULL))
d21 1
a21 6
     given by the function \code{gamma0BMAcontrol}.
  }
  \item{start}{
     An optional list of starting values for variance coefficients
     and weights. The default is to start with the variance coefficients
     equal to 1, and with equal weights for each member of the ensemble.
d23 22
d52 1
a52 1
  \item{meanCoefs}{
d58 1
a58 1
    observation (these are the same for all members of the ensemble).
d69 1
a69 1
    the models for the  point mass at 0 and mean of monzero observations. 
d79 1
a79 1
   This function does a single model fit for precipitation data.
d81 3
a83 1
   of fits over a larger precipitation data set.  
d87 5
a91 2
  \code{\link{gamma0BMAcontrol}}, 
  \code{\link{ensembleBMAgamma0}}
d94 2
a95 2
J. M. Sloughter, T. Gneiting, A. E. Raftery and C. Fraley, 
Probabilistic Quantitative Precipitation Forecasting 
d97 2
a98 2
Technical Report No. 496R, Department of Statistics, Univeristy of
Washington, February 2006.
d110 3
a112 3
  precip10 <- ensembleData( forecasts = precip10[ ,1:5],
                             observations = precip10[ ,6],
                             dates = precip10[ , 7])
d114 2
a115 2
# 5-day training period
  fit5 <- fitBMAgamma0(precip10[dates(precip10) <= 5, ], )
@


1.5
log
@*** empty log message ***
@
text
@d81 1
a81 1
# Note: a reduced data set and training period are used in this
@


1.4
log
@*** empty log message ***
@
text
@d92 2
a93 1
  fit15 <- fitBMAgamma0(precip10[dates(precip10) <= 5, ])
@


1.3
log
@*** empty log message ***
@
text
@a79 1
  data(precip20)
d81 4
a84 3
  precip20 <- ensembleData( forecasts = precip20[,1:9],
                             observations = precip20[, 10],
                             dates = precip20[, 11])
d86 7
a92 1
  fit15 <- fitBMAgamma0(precip20[dates(precip20) <= 15,])
@


1.2
log
@*** empty log message ***
@
text
@d86 1
a86 1
  fit30 <- fitBMAgamma0(precip20[dates(precip20) <= 15,])
@


1.1
log
@Initial revision
@
text
@d11 1
a11 1
fitBMAgamma0( weatherData, control = gamma0control(), 
d15 2
a16 2
  \item{weatherData}{
     A \code{weatherData} object with forecasts, observations and dates
d21 1
a21 1
     given by the function \code{gamma0control}.
d67 2
a68 2
  \code{\link{weatherData}}, 
  \code{\link{gamma0control}}, 
d80 1
a80 3
  precipData <- weatherData( forecasts = precipData[,1:9],
                             observations = precipData[, 10],
                             dates = precipData[, 11])
d82 5
a86 1
  fit30 <- fitBMAgamma0(precipData[dates(precipData) <= 30,])
d88 1
a88 1
\keyword{BMA}
@
