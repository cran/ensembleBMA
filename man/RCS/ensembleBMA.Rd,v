head	1.13;
access;
symbols;
locks
	fraley:1.13; strict;
comment	@# @;


1.13
date	2007.02.24.00.27.26;	author fraley;	state Exp;
branches;
next	1.12;

1.12
date	2007.02.22.19.52.15;	author fraley;	state Exp;
branches;
next	1.11;

1.11
date	2007.02.16.17.43.27;	author fraley;	state Exp;
branches;
next	1.10;

1.10
date	2007.02.14.23.19.44;	author fraley;	state Exp;
branches;
next	1.9;

1.9
date	2007.02.07.19.18.34;	author fraley;	state Exp;
branches;
next	1.8;

1.8
date	2007.02.07.18.55.52;	author fraley;	state Exp;
branches;
next	1.7;

1.7
date	2007.01.31.23.42.30;	author fraley;	state Exp;
branches;
next	1.6;

1.6
date	2007.01.31.23.26.41;	author fraley;	state Exp;
branches;
next	1.5;

1.5
date	2007.01.31.18.37.42;	author fraley;	state Exp;
branches;
next	1.4;

1.4
date	2006.12.29.20.36.12;	author fraley;	state Exp;
branches;
next	1.3;

1.3
date	2006.12.05.21.35.59;	author fraley;	state Exp;
branches;
next	1.2;

1.2
date	2006.12.01.20.33.12;	author fraley;	state Exp;
branches;
next	1.1;

1.1
date	2006.12.01.20.30.51;	author fraley;	state Exp;
branches;
next	;


desc
@@


1.13
log
@*** empty log message ***
@
text
@\name{ensembleBMA}
\alias{ensembleBMA}
\title{
    Bayesian Model Averaging for ensemble forecasts.  
}
\description{
   Fits a BMA mixture model to ensemble forecasts.
}
\usage{
ensembleBMA( ensembleData, dates = NULL, trainingRule = list(length=30,lag=2), 
             control = NULL, model = NULL, minCRPS = NULL, popData = NULL)
}
\arguments{
  \item{ensembleData}{
     An \code{ensembleData}, \code{temperatureData}, \code{pressureData}, 
     or \code{precipitationData} object including ensemble forecasts, 
     observations and dates. 
  }
 \item{dates}{
     The dates for which modeling is desired. By default, this will include all
     dates consistent with the training rule.
  }
  \item{trainingRule}{
     A list giving the \code{length} and \code{lag} for the training period.
     The default is to use a 30 time step training period for a forecast
     2 time steps ahead of the last time step in the training period.
  }
  \item{control}{
     A list of control values for the fitting functions. 
     The default is \code{controlBMAnormal()} for normal models
     and \code{controlBMAgamma0()} for gamma models with a point mass at 0.
  }
  \item{model}{
      A character string describing the BMA model to be fit. 
      Current choices are \code{"normal"}, typically used for temperature or pressure data,
      and \code{"gamma0"}, typically used for precipitation data.
  }
 \item{minCRPS}{
     A logical variable indicating whether or not to add a postprocessing
     step after a normal BMA fit to choose the standard deviation so as to
     minimize the CRPS. The default is not to do the CRPS minimization for
     normal data (e.g. temperature or pressure), because it can involve
     considerably more computation, particularly when unequal variances
     are specified in \code{control}. This argument is used only for
     normal models.
  }
  \item{popData}{
      Optional predictors for the logistic regression for probability of 
      precipitation. This option applies to the mixture of gammas model with 
      a point mass at zero that is used for precipitation.
      In this model, the default predictors are an intercept, the
      transformed forecast data, and a logical variable indicating
      whether or not the forecast is equal to 0. 
      In addition, the coefficient of the transformed forecast must 
      not be greater than 0 and that of the logical variable
      must not be less than 0 in the default. 
      If provided, the predictors in \code{popData} would replace the logical 
      variable in the regression, and no constraints are imposed on
      the regression coefficients. \cr
      To supply one pop predictor per ensemble member,
      \code{popData} can be a matrix or data frame (if the
      predictor is categorical) with number of rows equal to the
      number of observations, and number of columns equal to the
      ensemble size. \cr
      To supply multiple numeric pop predictors per ensemble member,
      \code{popData} can be an array of dimension (number of
      observations) by (ensemble size) by (number of pop predictors). \cr
      To supply multiple pop predictors per ensemble member, some of
      which may be categorical, \code{popData} must be a list of
     (number of observations) by (ensemble size) matrices, one
      for each pop predictor.
 }
}
\value{
A list with the following output components:
  \item{dateTable}{
    The table of observations corresponding to the dates in \code{x}   
     in chronological order.
  }
  \item{trainingRule}{
    The training rule specified as input.
  }
  \item{\dots}{
     One or more components corresponding to fitted coefficients for the model.
  }
  \item{weights}{
    The fitted weights for the mixture of gammas model for the
    nonzero observations at each date.
  }
  \item{transformation}{
    A function corresponding the transformation (if any) of the data used to fit 
    the models for the  point mass at 0 and mean of nonzero observations. 
    The untransformed forecast is used to fit the variance model.
    This is input as part of \code{control}.
   }
  \item{inverseTransformation}{
    A function corresponding to the inverse of \code{transformation} (if any).
    Used in various diagnostic methods for the output.
   }
}
\details{
   If dates are specified in \code{dates} that cannot be forecast 
   with the training rule, the corresponding BMA model parameter outputs will
   be missing (\code{NA}) but not \code{NULL}. \cr
   The training rule uses the number of days corresponding to its 
   \code{length} regardless of whether or not the dates are consecutive.\cr
   The following methods are available for the output of \code{ensembleBMA}:
   \code{gridForecastBMA}, \code{quantileForecastBMA}, 
   \code{bmaModelParameters},  \code{brierSkillScores}, and \code{crpsANDmae}.
}
\seealso{
  \code{\link{ensembleData}}, 
  \code{\link{forecastBMA}}, 
  \code{\link{ensembleBMAnormal}}, 
  \code{\link{ensembleBMAgamma0}},
  \code{\link{gridForecastBMA}},
  \code{\link{quantileForecastBMA}},
  \code{\link{bmaModelParameters}}, 
  \code{\link{brierSkillScores}},
  \code{\link{crpsANDmae}} 
}

\references{
A. E. Raftery, T. Gneiting, F. Balabdaoui and M. Polakowski,
Using Bayesian Model Averaging to Calibrate Forecast Ensembles,
\emph{Monthly Weather Review 133:1155-1174, 2005}.

J. M. Sloughter, A. E. Raftery, T. Gneiting and C. Fraley, 
Probabilistic Quantitative Precipitation Forecasting 
using Bayesian Model Averaging,
Technical Report No. 496R, Department of Statistics, University of
Washington, October 2006 (to appear in \emph{Montly Weather Review}).
}

\examples{
  data(slp)

  slpData <- ensembleData(forecasts = slp[c("AVN","GEM","ETA","NGM","NOGAPS")],
                          observations = slp$obs, dates = slp$date)

  slpFit <- ensembleBMA( slpData, model = "normal")

  data(prcp)

  prcpData <- ensembleData( dates = prcp$date, observations = prcp$obs,
                          forecasts = prcp[,c("CENT","AVN","CMCG","ETA",
                                      "GASP","JMA","NGPS","TCWB","UKMO")])

  prcpFit <- ensembleBMA(prcpData, trainingRule = list(length=25, lag=2),
                         model = "gamma0")
}
\keyword{models}
% docclass is function
@


1.12
log
@*** empty log message ***
@
text
@d10 1
a10 1
ensembleBMA( ensembleData, dates = NULL, training = list(length = 30, lag = 2), 
d23 1
a23 1
  \item{training}{
d25 2
a26 2
     The default is to use a 30 day training period for a forecast
     2 days ahead of the last day in the training period.
d80 1
a80 1
  \item{training}{
d149 1
a149 1
  prcpFit <- ensembleBMA(prcpData, training = list(length=25, lag=2),
@


1.11
log
@*** empty log message ***
@
text
@d139 1
a139 2
                          observations = slp$obs, dates = slp$date,
                          latitude = slp$lat, longitude = slp$lon)
d141 1
a141 1
  slpFit <- ensembleBMA( slpData,model = "normal")
d143 1
a143 4
# Note: a reduced data set and training period are used in this
# and other help file examples for fast execution. A much larger
# training period (and hence more data) is typically needed for
# good forecasting results.
d145 3
a147 1
  data(precip10)
d149 2
a150 6
  precip10data <- ensembleData( forecasts = precip10[ ,1:5],
                                observations = precip10[ ,6], 
                                dates = precip10[ ,7])

  precip10fit <- ensembleBMA( precip10data, model="gamma0",
                            training = list( length = 5, lag = 2))
@


1.10
log
@*** empty log message ***
@
text
@d118 1
a118 1
  \code{\link{parameters}}, 
d122 13
a135 1

d138 2
a139 2
  slpData <- ensembleData(forecasts = slp[c("AVN", "GEM", "ETA", "NGM", "NOGAPS")],
                          observations = slp$obs, dates = slp$init_date,
@


1.9
log
@*** empty log message ***
@
text
@d102 2
a103 2
   If dates are specified in \code{dates} that cannot be  forecast 
   with the training rule, the corresponding parameter outputs will
d108 2
a109 2
   \code{gridForecastBMA}, \code{quantileForecastBMA}, \code{parameters}, 
   \code{brierSkillScores}, and \code{crpsANDmae}.
d130 1
a130 1
  slpFit <- ensembleBMA( slpData)
@


1.8
log
@*** empty log message ***
@
text
@d123 1
d126 1
a126 1
  slpData <- ensembleData(forecasts = slp[forecasts = c("AVN", "GEM", "ETA", "NGM", "NOGAPS")],
@


1.7
log
@*** empty log message ***
@
text
@d125 3
a127 2
  slpData <- pressureData(forecasts = slp[,4:8], observations = slp[,9],
               dates = slp[,1], latitude = slp[,2], longitude = slp[,3])
@


1.6
log
@*** empty log message ***
@
text
@d56 1
a56 1
      must not be less than 0 in the default. \cr 
d58 2
a59 1
      variable in the regression, and no constraints are imposed. \cr
@


1.5
log
@*** empty log message ***
@
text
@d54 3
d58 1
a58 1
      variable in the regression. \cr
@


1.4
log
@*** empty log message ***
@
text
@a7 1
   The model to be fitted depends on the type of data.
d10 2
a11 2
ensembleBMA( ensembleData, training = list(length = 30, lag = 2), 
             control = NULL, type = NULL)
d19 4
d30 2
a31 10
     The default is \code{controlBMAnormal()} for temperature or
     pressure data and \code{controlBMAgamma0()} for precipitation data.
  }
  \item{type}{
      A character string describing the data type. 
      Must uniquely match the leading letters of one of the following:
     \code{"temperature"}, \code{"pressure"}, or \code{"precipitation"}. \cr
      This argument is optional if \code{ensembleData} is of class
     \code{"temperatureData"}, \code{"pressureData"}, 
      or \code{"precipitationData"}. 
d33 36
d72 1
a72 1
  \item{nObs}{
d87 1
a87 1
    The function corresponding the transformation of the data used to fit 
d93 1
a93 1
    The function corresponding to the inverse of \code{transformation}.
d98 3
a100 3
   The output is for all of the \code{dates} in \code{x}, so there
   will be missing entries denoted by \code{NA} for dates that are too recent 
   to be forecast with  the training rule. \\
d102 1
a102 1
   \code{length} regardless of whether or not the dates are consecutive.\\
d104 2
a105 1
   \code{quantileForecast} and \code{crpsANDmae}.
d111 6
a116 1
  \code{\link{ensembleBMAgamma0}}
d137 1
a137 1
  precipFit <- ensembleBMA( precip10data, type="precipitation",
@


1.3
log
@*** empty log message ***
@
text
@d11 2
a12 1
ensembleBMA( x, training = list(length = 30, lag = 2), control = NULL)
d15 4
a18 3
  \item{x}{
     A \code{temperatureData}, \code{pressureData}, or \code{precipitationData}
     object including ensemble forecasts, observations and integer dates. 
d27 10
d73 1
a73 1
   \code{quant} and \code{crpsANDmae}.
d77 3
a79 18
  \code{\link{ensembleBMAnormal}},
  \code{\link{ensembleBMAgamma0}},
  \code{\link{normalBMAcontrol}}, 
  \code{\link{gamma0BMAcontrol}}, 
  \code{\link{crpsANDmae}},
  \code{\link{quant}}
}
\references{
A. E. Raftery, T. Gneiting, F. Balabdaoui and M. Polakowski,
Using Bayesian Model Averaging to Calibrate Forecast Ensembles,
\emph{Monthly Weather Review 133, 1155-1174}.

J. M. Sloughter, A. E. Raftery, T. Gneiting and C. Fraley, 
Probabilistic Quantitative Precipitation Forecasting 
using Bayesian Model Averaging,
Technical Report No. 496R, Department of Statistics, University of
Washington, October 2006. \\
to appear in \emph{Montly Weather Review}.
d81 5
d87 1
a87 1
\examples{
d96 3
a98 3
  precip10 <- precipitationData( forecasts = precip10[ ,1:5],
                                 observations = precip10[ ,6],
                                 dates = precip10[ ,7])
d100 2
a101 1
  precipFit <- ensembleBMA( precip10, training = list( length = 5, lag = 2))
a104 8








@


1.2
log
@*** empty log message ***
@
text
@a85 1
  data(precip20)
d87 10
a96 3
  precip20 <- precipitationData( forecasts = precip20[,1:9],
                                 observations = precip20[, 10],
                                 dates = precip20[, 11])
d98 1
a98 1
  precipFit <- ensembleBMA( precip20, training = list( length = 15, lag = 2))
@


1.1
log
@Initial revision
@
text
@d64 1
a64 1
  \code{\link{weatherData}}, 
d96 8
@
